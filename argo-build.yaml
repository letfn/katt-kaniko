apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: defn-
  annotations:
    repo: "https://github.com/letfn/katt-kaniko"
    revision: master
    source: "k3d-hub.defn.ooo:5000/kaniko-project/executor:v1.6.0-debug"
    destination: "k3d-hub.defn.ooo:5000/kaniko:latest"
spec:
  entrypoint: build
  templates:
    - name: build
      inputs:
        artifacts:
          - name: source
            path: /src
            git:
              repo: "{{workflow.annotations.repo}}"
              revision: "{{workflow.annotations.revision}}"
      container:
        image: gcr.io/kaniko-project/executor
        args:
          - "--context=/src"
          - "--dockerfile=Dockerfile.build"
          - "--insecure-pull"
          - "--insecure"
          - "--destination={{workflow.annotations.destination}}"
          - "--build-arg"
          - "IMAGE={{workflow.annotations.source}}"
  securityContext:
    runAsNonRoot: false
