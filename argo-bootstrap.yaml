apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: katt-kaniko-bootstrap-
spec:
  entrypoint: build
  arguments:
    parameters:
      - name: repo
      - name: revision
      - name: source
      - name: destination
      - name: dockerfile
  templates:
    - name: build
      inputs:
        artifacts:
          - name: source
            path: /src
            git:
              repo: "{{inputs.parameters.repo}}"
              revision: "{{inputs.parameters.revision}}"
      container:
        image: gcr.io/kaniko-project/executor
        args:
          - "--context=/src"
          - "--dockerfile={{inputs.parameters.dockerfile}}"
          - "--insecure"
          - "--destination={{inputs.parameters.destination}}"
          - "--build-arg"
          - "IMAGE={{inputs.parameters.source}}"
  securityContext:
    runAsNonRoot: false
